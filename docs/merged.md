# Calorie Clash TS + Chakra 要件定義（MVP）

**一撃で伝える要点**

- **目的：** GUI版「満腹じゃんけん」。🎮
- **価値：** 直感操作。即プレイ。🥗
- **基盤：** TypeScript + Vite + Chakra UI。⚡️

------------------------------------------------------------------------

## 1. スコープ

- **対象:** デスクトップWeb / PWA。
- **ユーザー:** カジュアル層 / 対戦好き。
- **MVP:** 1P vs CPU、ルール選択、スコア保存。
- **非MVP:** オンライン対戦、課金、SNS連携。

## 2. 目標KPI

- 初回起動→対戦開始 **3タップ以内**。
- チュートリアル完了 **1分以内**。
- 1ゲーム平均 **90秒**。

## 3. 制約 / 前提

- フロント単体。サーバ不要（ローカルStorage使用）。
- 画面幅 360px〜。レスポンシブ必須。
- 日本語UI。英語は次期。

## 4. 用語

- **満腹度:** 上限に達すると負け。
- **ターゲットポイント:** 到達で勝利。
- **あいこ規則:** ルールで挙動切替。

## 5. ユーザーストーリー（MVP）

- **U1:** 即プレイ。タイトル→開始。
- **U2:** 手とカードを選び、勝敗・ポイント・満腹度を確認。
- **U3:** ルールを切り替える（原作準拠/簡易）。
- **U4:** 結果を記録し、ベストスコアを保持。
- **U5:** 好きな食べ物をCSVからインポートしてカードデッキを拡張。

## 5.1 原作準拠ルール（要旨）

- **カード:** 「グー/チョキ/パー」頭文字の食べ物名。
- **勝敗:** じゃんけんで決定。
- **勝者:** 出したカード名の文字数をポイント獲得。
- **敗者:** 出したカードの満腹値を加算。
- **勝利条件:** 相手を満腹でギブアップさせる or 50ポイント到達。
- **演出:** カード公開→勝敗→ポイント加算→満腹加算。

## 6. 画面一覧

1.  **タイトル**
2.  **ゲーム**
3.  **設定**
4.  **ヘルプ**
5.  **CSVインポート**（次期）

## 7. 画面要件

### 7.1 タイトル

- 原作準拠/簡易トグル、開始、設定、ヘルプ。

### 7.2 ゲーム

- 自分/CPUの手とカード名、ポイント、満腹バー、ラウンド。
- カード選択UI（候補1〜3枚）。

### 7.3 設定

- 勝利ポイント50（カスタム可）。
- 満腹上限（800/1000/1300）。
- あいこ処理設定。
- アニメ/音ON-OFF。
- カードデッキ編集（UI上で編集）。
- **CSVインポート**で食べ物追加（UTF-8、カンマ区切り、ヘッダー：`hand,name,satiety`）。

### 7.4 ヘルプ

- ルール図解とCSV取り込み方法。

## 8. 機能要件（FR）

- じゃんけん判定。
- ポイント加算=文字数。
- 満腹度加算=カードの満腹値。
- 勝利条件=50点 or 相手満腹。
- ルール/デッキ保存（localStorage）。
- ベスト記録保存/読込。
- アクセシビリティ対応。
- **CSVインポート/エクスポート機能**（次期）。

## 14. データモデル（例）

``` ts
export interface FoodCard {
  id: string;
  hand: 'rock' | 'paper' | 'scissors';
  name: string;
  points: number;
  satiety: number;
}

export interface GameRule {
  targetPoints: 30 | 40 | 50;
  physique: 800 | 1000 | 1300;
  tieRule: 'no_count' | 'satiety_plus_both';
  animation: boolean;
  sound: boolean;
  deck: FoodCard[];
  mode: 'original' | 'simple';
}

export interface CsvImportResult {
  success: boolean;
  errors?: string[];
  importedCards?: FoodCard[];
}
```

## 27. バックログ（次期）

- CPU思考レベル。
- リプレイ。
- 連勝ボーナス。
- コスチュームスキン。
- **CSVインポート/エクスポートによるカード共有**。

# Calorie Clash — じゃんけんバトル デザインドキュメント

- 目的:
  じゃんけんによりラウンド結果を決定し、スコアを加算する対戦フェーズ。
- プロトタイプ:
  [docs/html/calorie_clash_janken_battle_battle.html](html/calorie_clash_janken_battle_battle.html)

## 画面構成

- 選択リスト: `グー/チョキ/パー`
  のカード（絵文字＋ラベル）。`role=listbox/option`。
- 確認モーダル: 「これで戦う？」選択内容の確認、`やめる/戦う`。
- ステージ:
  コール＆レスポンス（ジャン/ケン/ポン）表示、左右に手を表示するアリーナ、`VS`。
- リザルト: `WIN/LOSE/DRAW` と日本語サブテキスト、`もう一度/戻る`。
- HUD: スコアボード（You/CPU）。
- 付加演出: 画面フラッシュ、スコア増分のフロート表示。

## 操作

- キーボード: `←/→` で選択移動、`Enter` で確定、`Esc` で取り消し。
- マウス/タッチ: カードタップで選択、モーダルのボタン操作。

## ロジック概要

- 定義: `CHOICES`（絵文字/名称）と `WINS`（勝ち関係）。
- 選択: プレイヤーのキー/クリックで `selected` を更新し確認モーダルへ。
- 対戦:
  CPUはランダムで手を選択。ジャン→ケン→ポンの順にアニメーション表示後、勝敗判定。
- スコア:
  勝ちでプレイヤー+1、負けでCPU+1、引き分けは増分なし。増分はHUD付近にアニメ表示。
- 進行: リザルト表示後、`もう一度` で再度選択フローへ、`戻る`
  でタイトル等へ戻る（モック）。

## レスポンシブ

- ビューポート幅/縦横比に応じてカード最小幅、アリーナ高さ、ステージパディングを調整。
- 720px以下 or 4:5以下では縦並び表示に最適化。

## アクセシビリティ

- 選択リストに `role`/`aria` を付与、カードは `:focus-visible`
  で可視化。
- ステージは `aria-live="polite"`/`aria-atomic` で進行文言を伝達。

## 実装メモ

- 依存: Anime.js（CDN）。
- 入力管理: `canInteract` で多重操作を抑制、`focusIdx`
  でキーボードフォーカスを循環。
- 小要素: フラッシュオーバーレイ、HUDのグラスモーフィズム、タッチ操作の
  `touch-action`。

# Calorie Clash — Mash Phase（満腹度テスト）デザインドキュメント

- 目的:
  一定時間内にタップで「食べる」アクションを行い、満腹度に応じた進捗で料理を完食。合計カロリーを競うフェーズ。
- プロトタイプ:
  [docs/html/calorie_clash_mash_phase_mash.html](html/calorie_clash_mash_phase_mash.html)

## ルール/パラメータ

- デフォルト時間: 90秒（`t` クエリで変更可）。
- 1回の食べる量: `bite` クエリ（既定25）。
- 満腹度: You/CPU それぞれ0–100%（`satMe`/`satOp`
  クエリ、UIからも変更可）。
- 対戦モード: `mode=cpu`（CPU自動タップ）/`mode=2p`（P2手動）。
- フードキュー:
  既定セットから順次表示（名前/絵文字/kcal）。完食でスコア加算し次へ。

## 画面構成

- HUD: 残り時間、スコアボード（You/CPU）。テストパネル開閉トグル。
- テストパネル（デバッグ用）: 満腹度スライダ、Auto
  Tap（tps指定）、相手プリセット、皿の進行制御。
- アリーナ:
  2レーン（You/相手）。各レーンに円形プレート（`conic-gradient`
  進捗）とフード表示、`TAP` ボタン。
- ヘルプ: スペースで食べる、満腹度で進行変化のヒント。
- リザルト: 合計カロリー（You/CPU）と `Retry`/`Next`。

## 操作

- キーボード: `Space` でYouのタップ。開始時に自動スタート。
- ポインタ: 各 `TAP`
  ボタンの押下で対応レーンに加点（2P時は相手側も有効）。
- テストパネル: トグルで開閉、各入力で即時反映。プリセットで一括変更。

## ロジック概要

- 満腹度関数: `appetite(s)`
  により満腹度に応じて実効バイト量を減衰（0–100%入力、逓減特性）。
- スコア加算: `addScore(side, bite)` が残量更新→進捗角 `--pdeg`
  更新→完食時に合計へ加算し次の料理へ。
- CPU: `mode='cpu'` の場合は基準220–440ms間隔で自動タップ。
- タイマー: `requestAnimationFrame`
  でtickし、0秒で終了→リザルト表示（Anime.jsで演出）。
- 視覚演出: フローティング `+kcal`
  のデルタを画面上に出現/消失（Anime.js）。

## レスポンシブ/セーフエリア

- 900px以下 or
  4:5以下で単一カラム化。HUDやテストパネルは幅に合わせて調整。
- `env(safe-area-inset-*)` を用いてノッチ対応のパディングを確保。

## アクセシビリティ

- ボタンの `aria-label` 付与、操作ヒントを明示。
- 重要情報（タイマー/結果）は視覚的に強調。追加の読み上げ最適化は今後対応余地あり。

## 実装メモ

- 依存: Anime.js（CDN）。
- CSS: カラートークン、`conic-gradient`
  で進捗、カード/UIのガラス風表現。
- URLパラメータで動作確認・デバッグが容易。

## 今後の課題

- 満腹度関数の係数チューニング/ランダム性導入。
- フード種類の難易度/報酬バランス設計。
- 2P同期・入力衝突時の処理、アクセシビリティ読み上げ強化。

# Calorie Clash — オプション（MVP）デザインドキュメント

- 目的:
  タイトル画面上に重なるモーダルで、音量/表示/テーマ/言語など基礎設定を変更・保存できるようにする。
- プロトタイプ:
  [docs/html/calorie_clash_options_screen_mvp_options.html](html/calorie_clash_options_screen_mvp_options.html)

## 画面構成

- モーダルカード:
  タイトルバー（`Options`/バージョン表示）、2カラム本体、フッターボタン群。
- セクション:
  - Audio: マスターボリューム（`range` + 値表示）、SFXトグル。
  - Visual FX: パーティクル数、速度、ビネットON/OFF。
  - Theme: スウォッチ（`radiogroup`相当）。
  - Language & Input:
    言語選択（日本語/英語）、ハイコントラスト切替、操作ヒント。
- フッター: `Defaults` / `Cancel` / `Apply`。

## 操作/キーバインド

- `Tab` で移動。`Space` でテーマ選択（スウォッチに `role="radio"`）。
- `Enter` = Apply、`Esc` = Cancel。
- ボリューム: 左右キーで1%、Shift+左右で10%刻み（UIヒントを表示）。

## 永続化/状態

- 保存先: `localStorage` キー `calorieClash.options`。
- 状態スキーマ:
  - `volume:number` (0–100)
  - `sfx:boolean`
  - `particles:number` (10–60)
  - `speed:number` (4–24)
  - `vignette:boolean`
  - `theme:'teal'|'purple'|'sunset'|'mono'`
  - `lang:'ja'|'en'`
  - `highContrast:boolean`
- 適用: `applyToUI()` がフォームと `body.dataset.theme` /
  `body.dataset.hc` を同期。
- `Defaults`: 既定値を適用（閉じない）。
- `Cancel`: 保存値を再ロードしUIへ反映して閉じる。
- `Apply`: 現在状態を保存して閉じる。

## レスポンシブ

- 720px以下または縦長時:
  モーダルがボトムシート風に全幅化、ボタンは均等割り付け。
- 本体はオーバーフロー時にスクロール（細いスクロールバーをスタイル）。

## アクセシビリティ

- ダイアログ: `role="dialog"` + `aria-modal` + `aria-labelledby`。
- テーマ選択: `role="radiogroup"` と各スウォッチに
  `role="radio"`/`aria-checked`/`tabindex`。
- フォーカスリング: `outline` に `--focus` を適用。
- ラベル: 範囲入力・トグルに `aria-label` を付与。

## 実装メモ

- イベント: `input` で値表示更新、`change` で状態反映/保存対象更新。
- `Shift+Arrow` によりボリュームを±10調整（UIとARIA値を同期）。
- ハイコントラストは `body.dataset.hc` で切替（スタイル拡張余地あり）。

## 今後の課題

- テーマ/ハイコントラストの全画面統合（ゲーム全体CSS変数適用）。
- 言語切替のi18n連携（テキスト資源の外部化）。
- モーダルのフォーカストラップ・戻り先管理。

# Calorie Clash — タイトル画面 デザインドキュメント

- 目的:
  ゲーム起動時のエントリーポイント。ロゴ提示と主要メニューへの導線を提供する。
- プロトタイプ:
  [docs/html/calorie_clash_title_screen_mvp_title.html](html/calorie_clash_title_screen_mvp_title.html)

## 画面構成

- ロゴ: `Calorie Clash` とサブコピー「胃袋 ×
  ロジック」。視覚的グラデーションとドロップシャドウ。
- メニュー: `Start` / `Options` / `Exit`
  の3項目。キーボード/マウス操作に対応。
- インフォパネル: 操作ヒント「↑↓で選択 / Enter: 決定 / Esc: 戻る」。
- フッター: 年次とバージョン、クレジット。
- 背景:
  パーティクルによる動的エフェクト（`<canvas id="fx">`）とビネット。

## 操作/ナビゲーション

- 初期フォーカス: メニュー先頭項目を自動フォーカス。
- キーボード: 上下矢印で移動、Enterで決定、Escでヒント表示。
- マウス/タッチ: 各ボタンのクリック/タップで決定。

## 状態/遷移

- Start: ダミー遷移（本編へ遷移予定）。
- Options: オプションモーダルを表示（別ドキュメント参照）。
- Exit: `confirm` で確認後にダミー処理。

## 視覚/レイアウト

- カラートークン: `--bg-0`, `--bg-1`, `--fg`, `--accent`, `--focus`
  など。
- レイアウト:
  `grid-template-rows: 220px auto 1fr auto`。各ブレークポイントでボタンサイズ・マージンを縮小。
- アニメーション:
  ロゴのフェードイン/スケール、ページ全体のフェードイン。
- パーティクル:
  ビューポート面積から個数を自動算出（20–30）。ランダム移動でエッジを超えたら再スポーン。

## レスポンシブ

- 1920px未満/1280px未満でロゴサイズ・マージン、ボタン寸法を段階的に縮小。
- 縦長画面（9:16以下）で行高を圧縮。

## アクセシビリティ

- メニューに `role="menu"`/`role="menuitem"`、ボタンに `aria-label`。
- フォーカス可視化: `outline` に `--focus` を使用。
- ライブリージョン: 操作ヒントを `aria-live="polite"` で更新。

## 実装メモ

- キー入力での選択インデックス管理（循環）。
- `canvas` は `filter: blur(var(--blur))`
  でソフト化、`requestAnimationFrame` ループで描画。
- `year` を起動時に現在年へ差し替え。
