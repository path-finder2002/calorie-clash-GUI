<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calorie Clash ‚Äî Janken Battle</title>
  <style>
    :root{
      --bg-0:#0B0F14;
      --fg:#E6F1FF;
      --muted:#A8B6C8;
      --accent:#00D1B2;
      --lose:#FF6B6B;
      --draw:#BAC4D0;
      --focus:#7AE3FF;
      --shadow-1:0 8px 24px rgba(0,0,0,.35);
      --shadow-2:0 16px 48px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(60% 60% at 50% 35%,rgba(255,255,255,.10),rgba(0,0,0,0)),var(--bg-0);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",Meiryo,sans-serif;overflow:hidden}
    main{position:relative;width:100vw;height:100dvh;display:grid;grid-template-rows:1fr auto;place-items:center;padding:40px}
    .choices{display:flex;gap:24px;align-items:stretch;justify-content:center;flex-wrap:nowrap;overflow-x:auto;padding:4px 8px 8px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:var(--shadow-1);display:grid;grid-template-rows:1fr auto;place-items:center;padding:18px;cursor:pointer;transition:transform .18s,box-shadow .18s,border-color .18s;min-width:260px;scroll-snap-align:center;touch-action:manipulation}
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow-2)}
    .card:focus-visible{outline:2px solid var(--focus);outline-offset:3px}
    .emo{font-size:clamp(56px,10vw,120px);line-height:1}
    .label{font-size:18px;color:var(--muted)}
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;place-items:center;z-index:30}
    .modal{width:min(480px,92vw);background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.12);border-radius:16px;box-shadow:var(--shadow-2);padding:18px}
    .modal h2{margin:0 0 8px;font-size:20px}
    .modal p{margin:0 0 14px;color:var(--muted)}
    .actions{display:flex;gap:10px;justify-content:flex-end}
    .btn{padding:12px 16px;min-height:44px;border-radius:12px;border:0;cursor:pointer;font-weight:700;letter-spacing:.02em;color:var(--fg);background:rgba(255,255,255,.08);touch-action:manipulation}
    .btn.primary{color:#00110E;background:linear-gradient(180deg,rgba(0,209,178,.9),rgba(0,185,158,.9))}
    .stage{position:absolute;inset:0;display:none;grid-template-rows:auto 1fr auto;align-items:center;justify-items:center;padding:40px;z-index:20;background:rgba(0,0,0,.9)}
    .chant{font-weight:800;letter-spacing:.2em;opacity:.9;font-size:clamp(16px,2.4vw,24px)}
    .arena{position:relative;display:grid;grid-template-columns:1fr 1fr;align-items:center;justify-items:center;width:min(1200px,92vw);height:min(380px,58vh)}
    .hand{font-size:clamp(80px,16vw,220px);filter:drop-shadow(0 8px 24px rgba(0,0,0,.4));opacity:0}
    .vs{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:900;font-size:clamp(18px,3vw,28px);opacity:.65;letter-spacing:.08em}
    .caption{color:var(--muted);margin-top:6px}
    .result{position:absolute;inset:0;display:none;place-items:center;text-align:center;z-index:25;background:rgba(0,0,0,.9);padding:24px}
    .result .text{font-weight:900;line-height:1;font-size:clamp(48px,10vw,160px);text-shadow:0 0 24px rgba(0,0,0,.35)}
    .result .sub{margin-top:8px;font-size:clamp(12px,1.6vw,18px);opacity:.85}
    .result .again{margin-top:18px}
    .flash{position:fixed;inset:0;background:#fff;pointer-events:none;opacity:0;z-index:24}
    .help{position:fixed;bottom:calc(12px + env(safe-area-inset-bottom));left:0;right:0;text-align:center;color:#A7B4C6;font-size:14px}
    kbd{background:#10161D;border:1px solid rgba(255,255,255,.2);padding:2px 6px;border-radius:6px}
    .scoreboard{position:fixed;top:calc(12px + env(safe-area-inset-top));left:50%;transform:translateX(-50%);display:flex;align-items:flex-end;gap:14px;padding:8px 12px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.12);border-radius:12px;box-shadow:var(--shadow-1);backdrop-filter:blur(6px);z-index:30}
    .scoreboard .side{display:grid;grid-template-columns:auto auto;align-items:end;gap:8px}
    .scoreboard .name{font-size:12px;color:var(--muted);opacity:.9}
    .scoreboard .num{font-weight:900;font-size:clamp(20px,3vw,36px)}
    .scoreboard .sep{opacity:.6;padding:0 6px}
    .delta{position:fixed;left:0;top:0;transform:translate(-50%,-12px);font-weight:900;font-size:20px;color:var(--accent);text-shadow:0 2px 8px rgba(0,0,0,.35);pointer-events:none;z-index:31}
    @media (max-width:980px){.choices{gap:16px;padding:4px 6px 10px}.card{min-width:240px}.arena{height:min(300px,52vh)}}
    @media (max-width:720px), (max-aspect-ratio:4/5){main{padding:20px}.stage{padding:20px}.modal-back{align-items:flex-end}.modal{width:100vw;border-radius:20px 20px 0 0;padding:16px 16px calc(16px + env(safe-area-inset-bottom))}.actions{gap:12px}.btn{flex:1}.arena{grid-template-columns:1fr;grid-template-rows:1fr 1fr;height:min(360px,58vh)}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
</head>
<body>
  <main>
    <div class="scoreboard" id="hud"><div class="side me"><span class="name">You</span><span class="num" id="pScore">0</span></div><div class="sep">‚Äî</div><div class="side cpu"><span class="name">CPU</span><span class="num" id="cScore">0</span></div></div>
    <section class="choices" role="listbox" aria-label="Êâã„ÇíÈÅ∏„Å∂">
      <button class="card" role="option" data-key="rock" aria-label="„Ç∞„Éº"><div class="emo">‚úä</div><div class="label">„Ç∞„Éº</div></button>
      <button class="card" role="option" data-key="scissors" aria-label="„ÉÅ„Éß„Ç≠"><div class="emo">‚úåÔ∏è</div><div class="label">„ÉÅ„Éß„Ç≠</div></button>
      <button class="card" role="option" data-key="paper" aria-label="„Éë„Éº"><div class="emo">üñêÔ∏è</div><div class="label">„Éë„Éº</div></button>
    </section>
    <div class="modal-back" id="confirm">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="m-title">
        <h2 id="m-title">„Åì„Çå„ÅßÊà¶„ÅÜÔºü</h2>
        <p id="m-desc">ÈÅ∏ÊäûÔºö<span id="sel"></span></p>
        <div class="actions"><button class="btn" id="cancel">„ÇÑ„ÇÅ„Çã</button><button class="btn primary" id="ok">Êà¶„ÅÜ</button></div>
      </div>
    </div>
    <section class="stage" id="stage" aria-live="polite" aria-atomic="true">
      <div class="chant" id="chant">„Ç∏„É£„É≥</div>
      <div class="arena"><div class="hand" id="pHand" aria-label="„ÅÇ„Å™„Åü"></div><div class="hand" id="cHand" aria-label="CPU"></div><div class="vs">VS</div></div>
      <div class="caption" id="cap">„Åò„ÇÉ„Çì‚Ä¶„Åë„Çì‚Ä¶</div>
    </section>
    <section class="result" id="result">
      <div>
        <div class="text" id="resText">WIN</div>
        <div class="sub" id="resSub">„ÅÇ„Å™„Åü„ÅÆÂãù„Å°</div>
        <div class="actions again"><button class="btn" id="again">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button><button class="btn" id="back">Êàª„Çã</button></div>
      </div>
    </section>
    <div class="flash" id="flash"></div>
    <div class="help">[<kbd>‚Üê/‚Üí</kbd>] ÁßªÂãï „Éª [<kbd>Enter</kbd>] Ê±∫ÂÆö „Éª [<kbd>Esc</kbd>] „Ç≠„É£„É≥„Çª„É´</div>
  </main>
  <script>
    const CHOICES={rock:{emoji:'‚úä',name:'„Ç∞„Éº'},scissors:{emoji:'‚úåÔ∏è',name:'„ÉÅ„Éß„Ç≠'},paper:{emoji:'üñêÔ∏è',name:'„Éë„Éº'}};
    const WINS={rock:'scissors',scissors:'paper',paper:'rock'};
    const cards=Array.from(document.querySelectorAll('.card'));
    const confirmEl=document.getElementById('confirm');
    const selEl=document.getElementById('sel');
    const okBtn=document.getElementById('ok');
    const cancelBtn=document.getElementById('cancel');
    const stage=document.getElementById('stage');
    const chant=document.getElementById('chant');
    const cap=document.getElementById('cap');
    const pHand=document.getElementById('pHand');
    const cHand=document.getElementById('cHand');
    const result=document.getElementById('result');
    const resText=document.getElementById('resText');
    const resSub=document.getElementById('resSub');
    const againBtn=document.getElementById('again');
    const backBtn=document.getElementById('back');
    const flash=document.getElementById('flash');
    const pScoreEl=document.getElementById('pScore');
    const cScoreEl=document.getElementById('cScore');
    let pScore=0,cScore=0;
    let selected=null;let canInteract=true;let focusIdx=0;cards[0].focus();
    cards.forEach(btn=>{btn.addEventListener('click',()=>choose(btn.dataset.key));});
    window.addEventListener('keydown',e=>{if(!canInteract)return;if(e.key==='ArrowLeft'){e.preventDefault();focusIdx=(focusIdx+2)%3;cards[focusIdx].focus();}if(e.key==='ArrowRight'){e.preventDefault();focusIdx=(focusIdx+1)%3;cards[focusIdx].focus();}if(e.key==='Enter'){e.preventDefault();choose(cards[focusIdx].dataset.key);}if(e.key==='Escape'){hideConfirm();}});
    function choose(key){selected=key;selEl.textContent=`${CHOICES[key].emoji} ${CHOICES[key].name}`;showConfirm();}
    function showConfirm(){confirmEl.style.display='grid';}
    function hideConfirm(){confirmEl.style.display='none';}
    cancelBtn.addEventListener('click',hideConfirm);
    okBtn.addEventListener('click',()=>{hideConfirm();startBattle(selected);});
    function startBattle(playerKey){canInteract=false;stage.style.display='grid';const cpuKey=pickCPU();pHand.textContent=CHOICES[playerKey].emoji;cHand.textContent=CHOICES[cpuKey].emoji;chant.textContent='„Ç∏„É£„É≥';cap.textContent='„Åò„ÇÉ„Çì‚Ä¶';setTimeout(()=>{chant.textContent='„Ç±„É≥';cap.textContent='„Åë„Çì‚Ä¶';},360);setTimeout(()=>{chant.textContent='„Éù„É≥!';cap.textContent='ÂãùË≤†ÔºÅ';handsIn(playerKey,cpuKey);},720);}
    function pickCPU(){const keys=Object.keys(CHOICES);return keys[Math.floor(Math.random()*keys.length)];}
    function isVertical(){return window.matchMedia('(max-width: 720px), (max-aspect-ratio: 4/5)').matches;}
    function handsIn(pKey,cKey){pHand.style.opacity=1;cHand.style.opacity=1;if(isVertical()){pHand.style.transform='translateY(-140px) scale(.9)';cHand.style.transform='translateY(140px) scale(.9)';anime({targets:pHand,translateY:[-140,0],scale:[.9,1.12,1],duration:520,easing:'easeOutCubic'});anime({targets:cHand,translateY:[140,0],scale:[.9,1.12,1],duration:520,easing:'easeOutCubic',complete(){const outcome=judge(pKey,cKey);showResult(outcome);}});}else{pHand.style.transform='translateX(-160px) scale(.9)';cHand.style.transform='translateX(160px) scale(.9)';anime({targets:pHand,translateX:[-160,0],scale:[.9,1.12,1],duration:480,easing:'easeOutCubic'});anime({targets:cHand,translateX:[160,0],scale:[.9,1.12,1],duration:480,easing:'easeOutCubic',complete(){const outcome=judge(pKey,cKey);showResult(outcome);}});}}
    function judge(p,c){if(p===c)return'draw';if(WINS[p]===c)return'win';return'lose';}
    function addPoints(side,delta){ if(delta<=0)return; const el=side==='p'?pScoreEl:cScoreEl; const start=side==='p'?pScore:cScore; const end=start+delta; const obj={v:start}; anime({targets:obj,v:end,duration:600,easing:'easeOutCubic',update(){ el.textContent=Math.round(obj.v); },complete(){ if(side==='p') pScore=end; else cScore=end; }}); const rect=el.getBoundingClientRect(); const d=document.createElement('div'); d.className='delta'; d.textContent='+'+delta; d.style.left=(rect.left+rect.width/2)+'px'; d.style.top=(rect.top)+'px'; if(side==='c'){ d.style.color=getComputedStyle(document.documentElement).getPropertyValue('--lose').trim(); } document.body.appendChild(d); anime({targets:d,translateY:-28,opacity:[0,1,0],scale:[.9,1,1],duration:700,easing:'easeOutCubic',complete(){ d.remove(); }}); }
    function award(outcome){ if(outcome==='win'){ addPoints('p',10); } else if(outcome==='lose'){ addPoints('c',10); } }
    function showResult(outcome){const color=outcome==='win'?getComputedStyle(document.documentElement).getPropertyValue('--accent').trim():outcome==='lose'?getComputedStyle(document.documentElement).getPropertyValue('--lose').trim():getComputedStyle(document.documentElement).getPropertyValue('--draw').trim();flashOnce();result.style.display='grid';
      award(outcome);if(outcome==='win'){resText.textContent='WIN';resText.style.color=color;resSub.textContent='„ÅÇ„Å™„Åü„ÅÆÂãù„Å°';}if(outcome==='lose'){resText.textContent='LOSE';resText.style.color=color;resSub.textContent='„ÅÇ„Å™„Åü„ÅÆË≤†„Åë';}if(outcome==='draw'){resText.textContent='DRAW';resText.style.color=color;resSub.textContent='„ÅÇ„ÅÑ„Åì';}anime({targets:'#result .text',scale:[.86,1.12,1],opacity:[0,1],duration:520,easing:'easeOutBack'});}
    function flashOnce(){flash.style.opacity=0;anime({targets:flash,background:['#fff','rgba(255,255,255,.35)','transparent'],duration:300,easing:'easeOutQuad'});}
    againBtn.addEventListener('click',resetStage);
    backBtn.addEventListener('click',()=>{resetStage();stage.style.display='none';canInteract=true;});
    function resetStage(){result.style.display='none';pHand.style.opacity=0;cHand.style.opacity=0;pHand.textContent='';cHand.textContent='';chant.textContent='„Ç∏„É£„É≥';cap.textContent='„Åò„ÇÉ„Çì‚Ä¶„Åë„Çì‚Ä¶';canInteract=true;}
  </script>
</body>
</html>
