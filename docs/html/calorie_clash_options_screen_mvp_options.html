<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calorie Clash — Options (MVP)</title>
  <style>
    :root{
      --bg-0:#0B0F14;
      --bg-1:#121820;
      --fg:#E6F1FF;
      --muted:#A8B6C8;
      --accent:#00D1B2;
      --focus:#7AE3FF;
      --shadow-1:0 8px 24px rgba(0,0,0,.35);
      --shadow-2:0 16px 48px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(60% 60% at 50% 35%, rgba(255,255,255,.10), rgba(0,0,0,0)) , var(--bg-0);
      color:var(--fg);
      font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", Meiryo, sans-serif;
    }

    /* 背景デモ（タイトル画面の上に出る想定） */
    .backdrop{position:fixed; inset:0; backdrop-filter: blur(8px); background: rgba(0,0,0,.45);}  

    /* モーダル */
    .modal{position:fixed; inset:0; display:grid; place-items:center; padding:24px}
    .card{
      width: min(720px, 92vw); height: min(520px, 88vh); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:16px; box-shadow: var(--shadow-2);
      display:grid; grid-template-rows: auto 1fr auto; overflow:hidden; animation: pop .25s cubic-bezier(.2,.8,.2,1) both;
    }
    header{ display:flex; align-items:center; gap:12px; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08); }
    header h1{ font-size:22px; margin:0; letter-spacing:.02em }
    header .ver{ margin-left:auto; opacity:.7; font-size:12px }

    .body{ display:grid; grid-template-columns: 1fr 1fr; gap:18px; padding:18px; overflow:auto }
    section{ border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:14px 14px 10px; background: rgba(0,0,0,.2); }
    section h2{ margin:0 0 8px; font-size:14px; text-transform:uppercase; letter-spacing:.08em; opacity:.9 }

    label{ display:grid; gap:6px; margin:10px 0 }
    label span{ font-size:13px; color:var(--muted) }
    input[type="range"]{ width:100% }

    /* スイッチ */
    .switch{ display:inline-flex; align-items:center; gap:10px }
    .switch input{ position:absolute; opacity:0; }
    .toggle{ width:46px; height:26px; border-radius:26px; background:#23303F; position:relative; box-shadow: inset 0 0 0 2px rgba(255,255,255,.06); transition:.2s }
    .knob{ position:absolute; top:3px; left:3px; width:20px; height:20px; border-radius:50%; background:#fff; transition:.2s }
    .switch input:checked + .toggle{ background: #1a574e }
    .switch input:checked + .toggle .knob{ left:23px }

    /* テーマ選択 */
    .themes{ display:flex; gap:8px; flex-wrap:wrap }
    .swatch{ width:56px; height:40px; border-radius:8px; border:2px solid transparent; cursor:pointer; position:relative }
    .swatch:focus-visible{ outline:2px solid var(--focus); outline-offset:3px }
    .swatch[data-selected="true"]{ border-color: var(--focus) }

    /* フッター */
    footer{ display:flex; gap:12px; justify-content:flex-end; padding:14px 16px; border-top:1px solid rgba(255,255,255,.08) }
    .btn{ padding:12px 16px; border-radius:12px; border:0; cursor:pointer; font-weight:600; letter-spacing:.02em; }
    .btn.secondary{ background: rgba(255,255,255,.06); color:var(--fg) }
    .btn.primary{ background: linear-gradient(180deg, rgba(0,209,178,.9), rgba(0,185,158,.9)); color:#00110E; }
    .btn:focus-visible{ outline:2px solid var(--focus); outline-offset:3px }

    /* アクセシビリティ注記 */
    .note{ font-size:12px; color:var(--muted); margin-top:6px }

    kbd{ background:#10161D; border:1px solid rgba(255,255,255,.15); border-bottom-color: rgba(0,0,0,.6); padding:2px 6px; border-radius:6px; font-size:12px }

    @keyframes pop{ from{ transform: translateY(6px) scale(.98); opacity:0 } to{ transform:none; opacity:1 } }

    /* スクロール見た目 */
    .body{ scrollbar-width:thin; scrollbar-color: #3a566e transparent }
    .body::-webkit-scrollbar{ width:10px }
    .body::-webkit-scrollbar-thumb{ background:#3a566e; border-radius:8px }
  </style>
</head>
<body>
  <!-- タイトル画面上のオーバーレイ想定。単体でも表示可能。 -->
  <div class="backdrop" aria-hidden="true"></div>
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="opt-title">
    <div class="card">
      <header>
        <h1 id="opt-title">Options</h1>
        <div class="ver" aria-hidden="true">v0.1.0</div>
      </header>

      <div class="body">
        <!-- Audio -->
        <section aria-labelledby="audio-h">
          <h2 id="audio-h">Audio</h2>
          <label>
            <strong>マスターボリューム <span id="volVal">40%</span></strong>
            <input type="range" id="volume" min="0" max="100" step="1" value="40" aria-valuemin="0" aria-valuemax="100" aria-valuenow="40" aria-label="マスターボリューム"/>
            <div class="note">左右キーで1%、Shift+左右で10%調整</div>
          </label>
          <label class="switch">
            <input id="sfx" type="checkbox" aria-label="効果音の再生" checked>
            <div class="toggle"><div class="knob"></div></div>
            <span>効果音（SFX）</span>
          </label>
        </section>

        <!-- Video/FX -->
        <section aria-labelledby="fx-h">
          <h2 id="fx-h">Visual FX</h2>
          <label>
            <strong>パーティクル数 <span id="pcVal">24</span></strong>
            <input type="range" id="particles" min="10" max="60" step="1" value="24" aria-label="パーティクル数" />
          </label>
          <label>
            <strong>速度 <span id="spdVal">12</span> px/s</strong>
            <input type="range" id="speed" min="4" max="24" step="1" value="12" aria-label="パーティクル速度" />
          </label>
          <label class="switch">
            <input id="vignette" type="checkbox" aria-label="ビネット効果" checked>
            <div class="toggle"><div class="knob"></div></div>
            <span>ビネット</span>
          </label>
        </section>

        <!-- Display / Theme -->
        <section aria-labelledby="theme-h">
          <h2 id="theme-h">Theme</h2>
          <div role="radiogroup" aria-label="テーマ">
            <button class="swatch" data-theme="teal" aria-label="ティール" data-selected="true" style="background:linear-gradient(180deg,#00D1B2,#008E7C)"></button>
            <button class="swatch" data-theme="purple" aria-label="パープル" style="background:linear-gradient(180deg,#8A7CFF,#6146FF)"></button>
            <button class="swatch" data-theme="sunset" aria-label="サンセット" style="background:linear-gradient(180deg,#FFB86B,#FF6B6B)"></button>
            <button class="swatch" data-theme="mono" aria-label="モノトーン" style="background:linear-gradient(180deg,#ECEFF4,#8E9AAF)"></button>
          </div>
          <div class="note">Tabで移動、Spaceで選択</div>
        </section>

        <!-- Language & Input -->
        <section aria-labelledby="lang-h">
          <h2 id="lang-h">Language & Input</h2>
          <label>
            <strong>表示言語</strong>
            <select id="lang" aria-label="表示言語">
              <option value="ja" selected>日本語</option>
              <option value="en">English</option>
            </select>
          </label>
          <div>
            <strong>操作</strong>
            <div class="note"><kbd>↑/↓</kbd> 選択 <kbd>Enter</kbd> 決定 <kbd>Esc</kbd> 閉じる</div>
          </div>
          <label class="switch" style="margin-top:10px">
            <input id="hc" type="checkbox" aria-label="ハイコントラスト">
            <div class="toggle"><div class="knob"></div></div>
            <span>ハイコントラスト</span>
          </label>
        </section>
      </div>

      <footer>
        <button class="btn secondary" id="reset">Defaults</button>
        <button class="btn secondary" id="cancel">Cancel <span class="note">(Esc)</span></button>
        <button class="btn primary" id="apply">Apply <span class="note">(Enter)</span></button>
      </footer>
    </div>
  </div>

  <script>
    // 設定の永続化（localStorage）
    const storeKey = 'calorieClash.options';
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const state = {
      volume: 40,
      sfx: true,
      particles: 24,
      speed: 12,
      vignette: true,
      theme: 'teal',
      lang: 'ja',
      highContrast: false,
    };

    function load(){
      try{ Object.assign(state, JSON.parse(localStorage.getItem(storeKey))||{}); }catch(_){ }
    }
    function save(){ localStorage.setItem(storeKey, JSON.stringify(state)); }

    function applyToUI(){
      $('#volume').value = state.volume; updateVol(state.volume);
      $('#sfx').checked = state.sfx;
      $('#particles').value = state.particles; $('#pcVal').textContent = state.particles;
      $('#speed').value = state.speed; $('#spdVal').textContent = state.speed;
      $('#vignette').checked = state.vignette;
      $('#lang').value = state.lang;
      $('#hc').checked = state.highContrast;
      $$('.swatch').forEach(w=> w.dataset.selected = (w.dataset.theme===state.theme));
      document.body.dataset.theme = state.theme;
      document.body.dataset.hc = state.highContrast ? '1' : '';
    }

    function updateVol(v){ $('#volVal').textContent = v + '%'; $('#volume').setAttribute('aria-valuenow', String(v)); }

    // UIイベント
    $('#volume').addEventListener('input', e=> updateVol( +e.target.value ));
    $('#volume').addEventListener('change', e=> state.volume = +e.target.value);
    $('#sfx').addEventListener('change', e=> state.sfx = e.target.checked);
    $('#particles').addEventListener('input', e=> { $('#pcVal').textContent = e.target.value; });
    $('#particles').addEventListener('change', e=> state.particles = +e.target.value);
    $('#speed').addEventListener('input', e=> { $('#spdVal').textContent = e.target.value; });
    $('#speed').addEventListener('change', e=> state.speed = +e.target.value);
    $('#vignette').addEventListener('change', e=> state.vignette = e.target.checked);
    $('#lang').addEventListener('change', e=> state.lang = e.target.value);
    $('#hc').addEventListener('change', e=> { state.highContrast = e.target.checked; document.body.dataset.hc = state.highContrast ? '1' : ''; });

    $$('.swatch').forEach(w=>{
      w.addEventListener('click', ()=>{ state.theme = w.dataset.theme; applyToUI(); });
      w.addEventListener('keydown', e=>{ if(e.code==='Space' || e.key===' '){ e.preventDefault(); state.theme = w.dataset.theme; applyToUI(); }});
      w.setAttribute('tabindex','0');
      w.setAttribute('role','radio');
      w.setAttribute('aria-checked', String(w.dataset.selected==='true'))
    });

    // ボタン
    $('#apply').addEventListener('click', ()=>{ save(); closeDialog('apply'); });
    $('#cancel').addEventListener('click', ()=>{ load(); applyToUI(); closeDialog('cancel'); });
    $('#reset').addEventListener('click', ()=>{ Object.assign(state, { volume:40, sfx:true, particles:24, speed:12, vignette:true, theme:'teal', lang:'ja', highContrast:false }); applyToUI(); });

    // キーボード（Enter=Apply / Esc=Cancel）
    window.addEventListener('keydown', e=>{
      if(e.key==='Enter'){ e.preventDefault(); $('#apply').click(); }
      if(e.key==='Escape'){ e.preventDefault(); $('#cancel').click(); }
      if(e.shiftKey && (e.key==='ArrowLeft' || e.key==='ArrowRight')){
        const dir = e.key==='ArrowRight' ? 10 : -10; const v = Math.max(0, Math.min(100, +$('#volume').value + dir)); $('#volume').value = v; updateVol(v);
      }
    });

    function closeDialog(reason){
      // MVP：閉じる動作の代わりにアラート。
      alert('Options closed ('+reason+').\nSaved: '+ (reason==='apply'));
    }

    // 初期化
    load(); applyToUI();
  </script>
</body>
</html>
