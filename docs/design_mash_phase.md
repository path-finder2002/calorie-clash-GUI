# Calorie Clash — Mash Phase（満腹度テスト）デザインドキュメント

- 目的: 一定時間内にタップで「食べる」アクションを行い、満腹度に応じた進捗で料理を完食。合計カロリーを競うフェーズ。
- プロトタイプ: [docs/html/calorie_clash_mash_phase_mash.html](html/calorie_clash_mash_phase_mash.html)

## ルール/パラメータ
- デフォルト時間: 90秒（`t` クエリで変更可）。
- 1回の食べる量: `bite` クエリ（既定25）。
- 満腹度: You/CPU それぞれ0–100%（`satMe`/`satOp` クエリ、UIからも変更可）。
- 対戦モード: `mode=cpu`（CPU自動タップ）/`mode=2p`（P2手動）。
- フードキュー: 既定セットから順次表示（名前/絵文字/kcal）。完食でスコア加算し次へ。

## 画面構成
- HUD: 残り時間、スコアボード（You/CPU）。テストパネル開閉トグル。
- テストパネル（デバッグ用）: 満腹度スライダ、Auto Tap（tps指定）、相手プリセット、皿の進行制御。
- アリーナ: 2レーン（You/相手）。各レーンに円形プレート（`conic-gradient` 進捗）とフード表示、`TAP` ボタン。
- ヘルプ: スペースで食べる、満腹度で進行変化のヒント。
- リザルト: 合計カロリー（You/CPU）と `Retry`/`Next`。

## 操作
- キーボード: `Space` でYouのタップ。開始時に自動スタート。
- ポインタ: 各 `TAP` ボタンの押下で対応レーンに加点（2P時は相手側も有効）。
- テストパネル: トグルで開閉、各入力で即時反映。プリセットで一括変更。

## ロジック概要
- 満腹度関数: `appetite(s)` により満腹度に応じて実効バイト量を減衰（0–100%入力、逓減特性）。
- スコア加算: `addScore(side, bite)` が残量更新→進捗角 `--pdeg` 更新→完食時に合計へ加算し次の料理へ。
- CPU: `mode='cpu'` の場合は基準220–440ms間隔で自動タップ。
- タイマー: `requestAnimationFrame` でtickし、0秒で終了→リザルト表示（Anime.jsで演出）。
- 視覚演出: フローティング `+kcal` のデルタを画面上に出現/消失（Anime.js）。

## レスポンシブ/セーフエリア
- 900px以下 or 4:5以下で単一カラム化。HUDやテストパネルは幅に合わせて調整。
- `env(safe-area-inset-*)` を用いてノッチ対応のパディングを確保。

## アクセシビリティ
- ボタンの `aria-label` 付与、操作ヒントを明示。
- 重要情報（タイマー/結果）は視覚的に強調。追加の読み上げ最適化は今後対応余地あり。

## 実装メモ
- 依存: Anime.js（CDN）。
- CSS: カラートークン、`conic-gradient` で進捗、カード/UIのガラス風表現。
- URLパラメータで動作確認・デバッグが容易。

## 今後の課題
- 満腹度関数の係数チューニング/ランダム性導入。
- フード種類の難易度/報酬バランス設計。
- 2P同期・入力衝突時の処理、アクセシビリティ読み上げ強化。

